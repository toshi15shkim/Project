<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tems.opr.setting.dao.SetUserMngMapper">

	<!-- 운영자 정보 조회 -->
	<select id="selectUserList" resultType="hashmap">
		SELECT *
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY USER_INPUTDATE DESC) AS SEQ, A.*
		FROM(
				SELECT USER_ID, USER_PWD, USER_NAME, DEPT_NAME, POS, TEL, HANDP, UI.GRP_ID, CONVERT(CHAR(20),USER_INPUTDATE,120) AS USER_INPUTDATE, USER_USE,  UI.AUTH_ID AUTH_ID, AUTH_NAME, GRP_NAME
				FROM USER_INFO UI INNER JOIN USER_AUTH UA ON UI.AUTH_ID=UA.AUTH_ID INNER JOIN SMS_GRP SG ON UI.GRP_ID=SG.GRP_ID
				WHERE  USER_USE='Y'
		) A) B

		<if test="endIndex != null and endIndex != ''">
		WHERE SEQ <![CDATA[<]]> #{endIndex}
		AND SEQ >= #{startIndex}
		</if>
	</select>
	
	<!-- 운영자 리스트 개수 조회 -->
	<select id="selectUserCount" resultType="Integer">
		SELECT COUNT(*) AS CNT FROM USER_INFO UI INNER JOIN USER_AUTH UA ON UI.AUTH_ID=UA.AUTH_ID INNER JOIN SMS_GRP SG ON UI.GRP_ID=SG.GRP_ID
		  WHERE USER_USE='Y'
	</select>
	
	<!-- 운영자 상세 조회 -->
	<select id="selectUserView" resultType="hashmap">
		 SELECT * FROM USER_INFO UI INNER JOIN USER_AUTH UA ON UI.AUTH_ID=UA.AUTH_ID INNER JOIN SMS_GRP SG ON UI.GRP_ID=SG.GRP_ID
  		 WHERE USER_ID = #{search_user_id}
	</select>
	
	<!-- 사용자 등록 -->
	<update id="insertUser">
	 INSERT INTO USER_INFO (USER_ID, USER_PWD, USER_NAME, DEPT_NAME, POS, TEL, HANDP, AUTH_ID, GRP_ID)
		  VALUES
		  (
			  #{userId}, #{userPwd}, #{userName}, #{deptName}, #{pos}, #{tel}, #{handp}, #{authId}, #{grpId}
		  )
	</update>
	
	<!-- 사용자 수정 -->
	<update id="updateUser">
		UPDATE USER_INFO
		   SET USER_PWD = #{userPwd},
       		   USER_NAME = #{userName},
       		   DEPT_NAME = #{deptNAME},
       		   POS = #{pos},
       		   TEL = #{tel},
       		   HANDP = #{handp},
       		   AUTH_ID = #{authID},
       		   GRP_ID = #{grpID}
         WHERE USER_ID = #{userId}
	</update>
	
	<!-- 사용자 삭제 -->
	<update id="deleteUser">
		UPDATE USER_INFO SET USER_USE = 'N' 
         WHERE USER_ID =  #{userId} AND USER_USE='Y'
	</update>
	
	<!-- 아이디 중복 체크 -->
	<select id="selectUserIdChk" resultType="Integer">
		SELECT COUNT(*) AS CNT
		  FROM USER_INFO
		 WHERE USER_ID = #{userId}
	</select>
		
</mapper>

