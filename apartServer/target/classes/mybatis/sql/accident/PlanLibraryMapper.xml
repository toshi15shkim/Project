<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tems.opr.accident.dao.PlanLibraryMapper">
	
	<!-- 대응방안 관리 조회 -->
	<select id="selectPlanLibraryList" resultType="hashMap">		
			SELECT DTL_EVENT_ID, CM.DTL_CD_NAME,EPC.TAG_DESC AS ACTIONS,PL.RISK_LEVEL, PL.PRIORITY, CMM.DN AS FACILITY, PL.SEQ, PL.PROC_TAG_NAME
      FROM PLAN_LIBRARY PL, CMM_CODE CM,EVENT_PROC_CATEG EPC,
          (SELECT DISTINCT CM.DTL_CD_ID AS DI,CM.DTL_CD_NAME AS DN FROM PLAN_LIBRARY PL , CMM_CODE CM
          WHERE PL.EQUIP_ID = CM.DTL_CD_ID AND CM.CD_ID='EQUIP_ID') AS CMM
      WHERE PL.EVENT_ID = CM.DTL_CD_ID AND PL.EQUIP_ID = CMM.DI AND PL.PROC_TAG_NAME=EPC.TAG_NAME
				<if test="AccidentGCate != null and AccidentGCate != ''">
					  AND DTL_CD_ID = #{AccidentGCate}
				</if>
				<if test="riskStatus != null and riskStatus != ''">
					  AND RISK_LEVEL = #{riskStatus}
				</if>
				<if test="ActionsGCate != null and ActionsGCate != ''">
					  AND PL.EQUIP_ID = #{ActionsGCate}
				</if>
				<if test="ActionsMCate != null and ActionsMCate != ''">
					  AND PROC_TAG_NAME = #{ActionsMCate}
				</if>
				<if test="tunnelId != null and tunnelId != ''">
					  AND PL.TUNNEL_ID = #{tunnelId}
				</if>
			ORDER BY PL.EVENT_ID, PL.DTL_EVENT_ID, PL.PRIORITY, PL.RISK_LEVEL, CMM.DN			
	</select>
	
	<!-- 대응방안 관리 상세 조회 -->
	<select id="selectPlanLibraryView" resultType="hashMap">
		 SELECT RISK_LEVEL, PRIORITY, REPLACE(EVENT_ID,' ','') AS EVENT_ID, REPLACE(DTL_EVENT_ID,' ','') AS DTL_EVENT_ID, REPLACE(EQUIP_ID,' ','') AS EQUIP_ID, REPLACE(PROC_TAG_NAME,' ','') AS PROC_TAG_CODE
      FROM PLAN_LIBRARY
      WHERE SEQ=#{index_num}
	</select>
	
	<!-- 대응방안 관리 등록 -->
	<update id="insertPlanLibrary">
	 INSERT INTO PLAN_LIBRARY (EVENT_ID, RISK_LEVEL, PRIORITY, EQUIP_ID,DTL_EVENT_ID, PROC_TAG_NAME, TUNNEL_ID)
		  VALUES
		  (
			  #{event_id}, #{risk_level}, #{priority}, #{equip_id}, #{dtl_event_id}, #{proc_tag_name}, #{tunnel_id}
		  )
	</update>	
	
	<!-- 대응방안 관리 수정 -->
	<update id="updatePlanLibrary">
		UPDATE PLAN_LIBRARY SET EVENT_ID = #{event_id},
		   			 DTL_EVENT_ID = #{dtl_event_id},
       		   EQUIP_ID = #{equip_id},
		   			 PROC_TAG_NAME = #{proc_tag_name},
		   			 RISK_LEVEL = #{risk_level},
       		   PRIORITY = #{priority}
         WHERE SEQ = ${index_num}
	</update>
	
	<!-- 대응방안 관리 삭제 -->
	<update id="deletePlanLibrary">
		DELETE FROM PLAN_LIBRARY WHERE SEQ = #{index_num}
	</update>
	
</mapper>

